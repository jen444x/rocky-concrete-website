---
import { sanityClient, urlFor } from "../sanity/client";

// Fetch the About Us photo from Site Images document
const siteImages = await sanityClient.fetch(`
  *[_type == "siteImages"][0] {
    "aboutUsPhoto": aboutUsPhoto->{ _id, title, alt, image }
  }
`);

// Fallback to most recent featured photo if none set
const fallbackPhoto = !siteImages?.aboutUsPhoto ? await sanityClient.fetch(`
  *[_type == "galleryItem" && featured == true] | order(orderRank asc)[0] {
    _id,
    title,
    alt,
    image
  }
`) : null;

const heroPhoto = siteImages?.aboutUsPhoto || fallbackPhoto;
---

<!-- LIGHT Section - Breathing Room After Dark Hero -->
<section class="about-us section-padding bg-white border-t border-bronze/10" id="about-us">
  <div class="container max-w-7xl mx-auto px-6 md:px-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-center">
      <!-- Single Hero Image with Overlapping Card -->
      <div class="about-image-container scroll-reveal opacity-0">
        {heroPhoto ? (
          <div class="image-wrapper">
            <img
              src={urlFor(heroPhoto.image).width(800).height(600).quality(90).auto('format').url()}
              alt={heroPhoto.alt || heroPhoto.title || "Rocky Concrete craftsmanship"}
              class="hero-image"
              loading="lazy"
              width="800"
              height="600"
            />

            <!-- Overlapping Info Card -->
            <div class="info-card">
              <h3 class="info-card-title">Get in Touch</h3>
              <div class="info-card-item">
                <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
                <a href="tel:+16613784017" class="info-link">(661) 378-4017</a>
              </div>
              <div class="info-card-item">
                <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
                <span class="info-text">Bakersfield, CA<br/>& Surrounding Areas</span>
              </div>
            </div>
          </div>
        ) : (
          <!-- Fallback if no photos -->
          <div class="bg-charcoal/5 rounded-lg aspect-4/3 flex items-center justify-center">
            <span class="text-slate">Photo coming soon</span>
          </div>
        )}
      </div>

      <!-- Text Content - Clean & Professional -->
      <div class="about-us-text-box text-center md:text-left">
        <!-- Heading - Bebas Neue for consistency -->
        <h2 class="section-heading text-charcoal mb-6 scroll-reveal opacity-0" style="animation-delay: 0.1s">
          TRUSTED EXPERTS IN CONCRETE & LANDSCAPING
        </h2>

        <!-- Thin divider line -->
        <div class="bronze-divider mb-6 mx-auto md:mx-0 scroll-reveal opacity-0" style="animation-delay: 0.2s"></div>

        <!-- Body Copy - Generous line height for readability -->
        <p class="section-subheading text-slate mb-6 scroll-reveal opacity-0" style="animation-delay: 0.3s">
          With over 15 years of experience, Rocky Concrete is Bakersfield's trusted
          concrete contractor and landscaping company. We proudly serve Kern County
          including Bakersfield, Oildale, Shafter, Delano, and surrounding communities.
        </p>

        <p class="section-subheading text-slate mb-8 scroll-reveal opacity-0" style="animation-delay: 0.4s">
          As a family-operated business, we prioritize customer satisfaction,
          delivering exceptional results in every project. From concrete driveways and
          stamped patios to custom outdoor kitchens, fire pits, and complete
          landscape design, our expert team transforms outdoor spaces
          with precision and care.
        </p>

        <!-- CTA Button -->
        <a
          href="#cta"
          class="about-cta-btn scroll-reveal opacity-0"
          style="animation-delay: 0.5s"
        >
          Get a Free Quote
        </a>
      </div>
    </div>
  </div>
</section>

<!-- SCROLL ANIMATION SCRIPT -->
<script>
  import { initScrollAnimations, CONTENT_CONFIG } from '../utils/animations.js';

  // About section is text-heavy, use CONTENT_CONFIG (600ms, 80px buffer)
  initScrollAnimations('.about-us .scroll-reveal', CONTENT_CONFIG);
</script>

<style>
  /* Import reusable animations */
  @import '../styles/animations.css';

  /* Image container with room for overlapping card */
  .about-image-container {
    position: relative;
  }

  .image-wrapper {
    position: relative;
    padding-bottom: 60px; /* Room for card overlap */
  }

  /* Main hero image - sharp corners */
  .hero-image {
    width: 100%;
    height: auto;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    box-shadow:
      0 4px 6px rgba(0, 0, 0, 0.05),
      0 10px 30px rgba(0, 0, 0, 0.1);
  }

  /* Overlapping info card - sharp corners, vertical layout */
  .info-card {
    position: absolute;
    bottom: 0;
    left: 20px;
    max-width: 280px;
    background: var(--color-charcoal);
    padding: 24px 28px;
    box-shadow:
      0 4px 6px rgba(0, 0, 0, 0.1),
      0 12px 30px rgba(0, 0, 0, 0.15);
  }

  .info-card-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.25rem;
    color: white;
    letter-spacing: 1px;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--color-bronze);
  }

  .info-card-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 14px;
  }

  .info-card-item:last-child {
    margin-bottom: 0;
  }

  .info-icon {
    width: 18px;
    height: 18px;
    color: var(--color-bronze);
    flex-shrink: 0;
    margin-top: 2px;
  }

  .info-link {
    color: white;
    font-family: 'Inter', sans-serif;
    font-size: 0.95rem;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .info-link:hover {
    color: var(--color-bronze);
  }

  .info-text {
    color: rgba(255, 255, 255, 0.85);
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    line-height: 1.5;
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    .image-wrapper {
      padding-bottom: 50px;
    }

    .info-card {
      left: 0;
      right: 0;
      max-width: none;
      padding: 20px 24px;
    }

    .info-card-title {
      font-size: 1.1rem;
      margin-bottom: 12px;
      padding-bottom: 10px;
    }

    .info-link,
    .info-text {
      font-size: 0.85rem;
    }
  }

  /* CTA Button - pill shape like reference */
  .about-cta-btn {
    display: inline-block;
    background: var(--color-bronze);
    color: white;
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    font-weight: 500;
    padding: 14px 32px;
    border-radius: 50px;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(184, 134, 11, 0.25);
  }

  .about-cta-btn:hover {
    background: var(--color-bronze-dark, #9a7209);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(184, 134, 11, 0.35);
  }

  @media (max-width: 768px) {
    .about-cta-btn {
      width: 100%;
      text-align: center;
    }
  }
</style>
